<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel de Administra√ß√£o de Chaves</title>
  <style>
    :root {
      --bg: #f0f2f5;
      --text: #333;
      --panel: #fff;
      --primary: #007bff;
      --secondary: #6c757d;
      --danger: crimson;
      --success: #28a745;
      --error: #dc3545; /* Usado para erros e toasts de erro */
      --info: #17a2b8; /* Cor para toasts informativos, se desejar */
      --shadow: 0 4px 24px rgba(0,0,0,0.12);
    }
    body.dark {
      --bg: #181c24;
      --text: #e6e6e6;
      --panel: #232837;
      --primary: #3ea6ff;
      --secondary: #444c5e;
      --danger: #ff3b3b;
      --success: #38e38a;
      --error: #ff6b6b;
      --info: #4bc0d3;
      --shadow: 0 4px 24px rgba(0,0,0,0.36);
    }
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      margin: 0;
      min-height: 100vh;
      transition: background-color 0.3s, color 0.3s;
    }
    .container {
      max-width: 700px;
      margin: 40px auto 0 auto;
      background-color: var(--panel);
      padding: 30px 28px 20px 28px;
      border-radius: 10px;
      box-shadow: var(--shadow);
      position: relative;
    }
    .logo-admin {
      width: 44px;
      vertical-align: middle;
      margin-right: 8px;
    }
    h1, h2 {
      color: var(--primary);
      border-bottom: 2px solid var(--primary);
      padding-bottom: 10px;
      margin-top: 0;
    }
    h1 { margin-bottom: 25px;}
    h2 { margin-top: 25px; margin-bottom: 15px; font-size: 1.5em;}

    label {
      display: block;
      margin-top: 15px;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type="text"], input[type="number"], input[type="password"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 1rem;
      box-sizing: border-box;
      background: var(--panel);
      color: var(--text);
    }
    input[readonly] {
      background: #e9ecef; /* Considerar var() para tema escuro */
      color: #444;
      font-family: monospace;
    }
    body.dark input[readonly] {
        background: #3a3f4b;
        color: #ccc;
    }
    button {
      background-color: var(--primary);
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
      font-size: 1rem;
      transition: background-color 0.15s;
      min-width: 110px;
      position: relative; /* Para o spinner */
      display: inline-flex; /* Para alinhar texto e spinner */
      align-items: center;
      justify-content: center;
    }
    button[disabled] {
      opacity: 0.6;
      cursor: not-allowed;
    }
    button.secondary { background-color: var(--secondary); }
    button.secondary:hover:not([disabled]) { background-color: #545b62; }
    body.dark button.secondary:hover:not([disabled]) { background-color: #5a6268; }

    button.danger { background-color: var(--danger); }
    button.danger:hover:not([disabled]) { background-color: darkred; }
    body.dark button.danger:hover:not([disabled]) { background-color: #c82333; }
    
    .status-message.success { color: var(--success); font-weight: bold; }
    .status-message.error { color: var(--error); font-weight: bold; }

    .key-list { list-style: none; padding: 0; margin: 0; }
    .key-list li {
      background: #e9ecef;
      margin-bottom: 5px;
      padding: 8px 8px 8px 16px;
      border-radius: 3px;
      font-family: monospace;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: var(--text); /* Cor de texto geral */
    }
    body.dark .key-list li {
        background: #2c3242;
        color: var(--text);
    }

    .copy-btn {
      background: transparent;
      border: none;
      color: var(--primary);
      cursor: pointer;
      font-size: 1.1em;
      margin-left: 12px;
      padding: 2px 4px;
      border-radius: 3px;
      transition: background 0.15s;
    }
    .copy-btn:hover { background: #dbeafe; }
    body.dark .copy-btn:hover { background: #3a3f4b; }

    #output, .keys-container {
      margin-top: 20px;
      padding: 12px;
      background: #f8f9fa;
      border: 1px solid #ccc;
      border-radius: 4px;
      min-height: 35px;
      font-size: 1.05em;
      color: var(--text); /* Cor de texto geral */
    }
    body.dark #output, body.dark .keys-container {
        background: #2c3242;
        border-color: #444c5e;
        color: var(--text);
    }

    .toast {
      position: fixed;
      bottom: 32px;
      right: 32px;
      background: var(--panel);
      color: var(--text);
      border-left: 6px solid var(--primary); /* Cor padr√£o */
      box-shadow: var(--shadow);
      padding: 16px 24px;
      border-radius: 6px;
      font-size: 1.1em;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s, transform 0.3s, border-left-color 0.3s;
      transform: translateY(40px);
    }
    .toast.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }
    .toast.success { border-left-color: var(--success); }
    .toast.error   { border-left-color: var(--error); }
    .toast.info    { border-left-color: var(--info); } /* Adicionado para consist√™ncia */


    .theme-toggle {
      position: absolute;
      top: 24px;
      right: 24px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.5em;
      color: var(--primary);
      transition: color 0.2s;
      padding: 5px; /* Aumentar √°rea de clique */
    }
    .theme-toggle:hover { color: var(--danger); }

    .confirm-modal-bg {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.25);
      z-index: 2000;
      display: flex; /* Controlado por JS: none/flex */
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(2px);
    }
    .confirm-modal {
      background: var(--panel);
      color: var(--text);
      padding: 30px 36px 22px 36px;
      border-radius: 10px;
      box-shadow: var(--shadow);
      min-width: 320px;
      max-width: 90vw;
      text-align: center;
    }
    .confirm-modal p { margin-top: 0; margin-bottom: 20px; font-size: 1.1em;}
    .confirm-modal button { margin: 0 8px;}

    .footer {
      margin-top: 30px;
      text-align: center;
      color: #888;
      font-size: 0.97em;
      padding-bottom: 10px;
    }
    body.dark .footer { color: #666; }

    /* Spinner CSS */
    .spinner {
      display: inline-block;
      width: 1em; /* Tamanho relativo ao font-size do bot√£o */
      height: 1em;
      border: 3px solid currentColor; /* Usa a cor do texto do bot√£o */
      border-right-color: transparent; /* Cria o efeito de "gap" no c√≠rculo */
      border-radius: 50%;
      animation: spin .75s linear infinite;
      margin-left: 10px; /* Espa√ßo entre o texto do bot√£o e o spinner */
      vertical-align: -0.125em; /* Ajuste fino vertical */
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    /* Em bot√µes secund√°rios com tema claro, a cor do texto pode ser escura */
    body:not(.dark) button.secondary { color: var(--text); } /* Se o texto for escuro no tema claro */
    body:not(.dark) button.secondary .spinner {
        border: 3px solid currentColor;
        border-right-color: transparent;
    }


    @media (max-width: 600px) {
      .container { padding: 20px 15px; margin: 20px auto; }
      h1 { font-size: 1.5em; }
      h2 { font-size: 1.3em;}
      button { font-size: 0.95rem; padding: 10px 12px;}
      .confirm-modal { padding: 20px 25px 15px 25px; }
      .toast { width: calc(100% - 40px); right: 20px; bottom: 20px; }
    }
  </style>
</head>
<body>
  <div class="container" aria-label="Painel de Administra√ß√£o">
    <button class="theme-toggle" id="themeToggle" title="Alternar tema" aria-label="Alternar tema">üåì</button>
    <h1>
      <img src="https://img.icons8.com/ios-filled/50/007bff/lock-2.png" alt="" class="logo-admin"/>
      Painel de Administra√ß√£o
    </h1>

    <div id="loginModal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.18);display:flex;align-items:center;justify-content:center;z-index:1000;">
      <form id="loginForm" style="background:var(--panel);padding:32px 28px 22px 28px;border-radius:8px;box-shadow:var(--shadow);min-width:320px;max-width:90vw;text-align:center;">
        <h2 style="color:var(--primary);margin-top:0;">Login Admin</h2>
        <label for="adminSecretModal" style="margin-top:0;">Senha de Admin:</label>
        <input type="password" id="adminSecretModal" autocomplete="current-password" aria-label="Senha de Admin" placeholder="Digite sua senha (ex: admin1x)" style="width:100%;padding:10px;margin-bottom:10px;border-radius:4px;border:1px solid #ccc;font-size:1rem;box-sizing:border-box;" />
        <button type="submit" id="btnLogin" style="width:100%;margin-top:6px;">Entrar</button>
        <div id="loginError" class="status-message error" style="margin-top:10px;min-height:1.2em;display:none;"></div>
      </form>
    </div>

    <section aria-labelledby="generate-keys-title">
      <h2 id="generate-keys-title">Gerar Novas Chaves</h2>
      <label for="keyCount">Quantidade (1‚Äì100):</label>
      <input type="number" id="keyCount" min="1" max="100" value="5" aria-describedby="keyCountHelp" />
      <button id="btnGerar" onclick="generateKeys()" disabled>Gerar</button>
    </section>

    <section aria-labelledby="view-keys-title">
      <h2 id="view-keys-title">Visualizar Chaves</h2>
      <button id="btnVer" class="secondary" onclick="viewKeys()" disabled>Ver Chaves</button>
      <div id="keysListDisplay" class="keys-container" aria-live="polite">Nenhuma chave carregada ainda.</div>
    </section>
    
    <section aria-labelledby="delete-keys-title">
      <h2 id="delete-keys-title">Excluir Chaves</h2>
      <form id="deleteSpecificKeyForm">
        <label for="deleteKey">Excluir chave espec√≠fica:</label>
        <input type="text" id="deleteKey" placeholder="Ex: 1234-5678-ABCD-EFGH" />
        <button type="button" id="btnExcluir" class="secondary" onclick="deleteSpecificKey()" disabled>Excluir Chave</button>
      </form>
      <div style="margin-top:15px;">
        <button id="btnExcluirTodas" class="danger" onclick="deleteAllKeysConfirm()" disabled>üß® Excluir Todas as Chaves</button>
      </div>
    </section>

    <h2>Status:</h2>
    <div id="output" aria-live="polite" class="status-message">Aguardando a√ß√£o...</div>
    
    <div style="margin-top: 18px; text-align: right;">
      <button id="btnLogout" class="secondary" style="padding: 6px 18px;display:none;">Sair</button>
    </div>

    <div class="footer">
      ¬© <span id="currentYear"></span> Painel Admin | Feito por Luke | Vers√£o 1.2
    </div>
  </div>

  <!-- Toast Notification (inicialmente oculto) -->
  <div id="toast" class="toast" role="alert"></div>

  <!-- Modal de Confirma√ß√£o (inicialmente oculto) -->
  <div id="confirmModal" class="confirm-modal-bg" style="display: none;" role="alertdialog" aria-modal="true" aria-labelledby="confirmModalMessage">
    <div class="confirm-modal">
      <p id="confirmModalMessage"></p>
      <button id="confirmModalYes">Sim</button>
      <button id="confirmModalNo" class="secondary">Cancelar</button>
    </div>
  </div>

  <script>
    // --- CONFIGURA√á√ÉO ---
    const BACKEND_URL = "https://keygenx-ce8h.onrender.com"; // Defina a URL do backend

    // --- ELEMENTOS DO DOM ---
    const themeToggleButton = document.getElementById('themeToggle');
    const loginModal = document.getElementById('loginModal');
    const loginForm = document.getElementById('loginForm');
    const btnLogin = document.getElementById('btnLogin');
    const adminSecretModalInput = document.getElementById('adminSecretModal');
    const loginErrorDiv = document.getElementById('loginError');
    const btnLogout = document.getElementById('btnLogout');
    const outputDiv = document.getElementById('output');
    const keysListDisplayDiv = document.getElementById('keysListDisplay');
    const keyCountInput = document.getElementById('keyCount');
    const deleteKeyInput = document.getElementById('deleteKey');
    const currentYearSpan = document.getElementById('currentYear');

    const btnGerar = document.getElementById('btnGerar');
    const btnVer = document.getElementById('btnVer');
    const btnExcluir = document.getElementById('btnExcluir');
    const btnExcluirTodas = document.getElementById('btnExcluirTodas');
    
    const toastElement = document.getElementById('toast');
    let toastTimeout;

    const confirmModalElement = document.getElementById('confirmModal');
    const confirmModalMessageP = document.getElementById('confirmModalMessage');
    const confirmModalYesBtn = document.getElementById('confirmModalYes');
    const confirmModalNoBtn = document.getElementById('confirmModalNo');
    let currentConfirmCallback = null;

    // --- ESTADO DA APLICA√á√ÉO ---
    let adminSecret = ''; // Guarda a senha em mem√≥ria enquanto a p√°gina estiver aberta

    // --- FUN√á√ïES UTILIT√ÅRIAS ---
    function setLoading(buttonElement, isLoading) {
      if (isLoading) {
        buttonElement.disabled = true;
        if (!buttonElement.querySelector('.spinner')) {
          const spinnerSpan = document.createElement('span');
          spinnerSpan.className = 'spinner';
          buttonElement.appendChild(spinnerSpan);
        }
      } else {
        buttonElement.disabled = false;
        const spinnerSpan = buttonElement.querySelector('.spinner');
        if (spinnerSpan) spinnerSpan.remove();
      }
    }

    function showOutput(type, message, timeout = 0) {
      outputDiv.className = `status-message ${type}`; // Adiciona 'status-message' para estiliza√ß√£o base
      outputDiv.textContent = message;
      if (timeout > 0) {
        setTimeout(() => {
          outputDiv.className = 'status-message';
          outputDiv.textContent = 'Aguardando a√ß√£o...';
        }, timeout);
      }
    }

    function copyKeyToClipboard(keyText, buttonElement) {
      navigator.clipboard.writeText(keyText).then(() => {
        const originalContent = buttonElement.textContent;
        buttonElement.textContent = '‚úîÔ∏è';
        setTimeout(() => { buttonElement.textContent = originalContent; }, 1200);
        showToast('Chave copiada!', 'success');
      }).catch(err => {
        showToast('Erro ao copiar.', 'error');
        console.error('Erro ao copiar chave:', err);
      });
    }
    
    function showToast(message, type = 'info') { // type: 'info', 'success', 'error'
        if (toastTimeout) clearTimeout(toastTimeout);
        
        toastElement.textContent = message;
        toastElement.className = `toast show ${type}`; // Adiciona classe de tipo
        
        toastTimeout = setTimeout(() => {
            toastElement.className = 'toast';
        }, 3000);
    }

    function showConfirmModal(message, onConfirm) {
        confirmModalMessageP.textContent = message;
        currentConfirmCallback = onConfirm;
        confirmModalElement.style.display = 'flex';
        confirmModalYesBtn.focus();
    }

    confirmModalYesBtn.onclick = () => {
        confirmModalElement.style.display = 'none';
        if (currentConfirmCallback) currentConfirmCallback();
        currentConfirmCallback = null;
    };

    confirmModalNoBtn.onclick = () => {
        confirmModalElement.style.display = 'none';
        currentConfirmCallback = null;
    };

    // --- L√ìGICA DE AUTENTICA√á√ÉO E PAINEL ---
    function setPanelEnabled(enabled) {
      [btnGerar, btnVer, btnExcluir, btnExcluirTodas, deleteKeyInput, keyCountInput].forEach(el => {
        if (el) el.disabled = !enabled;
      });
      btnLogout.style.display = enabled ? 'inline-flex' : 'none'; // inline-flex para consist√™ncia com bot√µes
    }

    async function handleLogin() {
      const password = adminSecretModalInput.value.trim();
      if (!password) {
        loginErrorDiv.textContent = 'Digite a senha de admin.';
        loginErrorDiv.style.display = 'block';
        return;
      }

      setLoading(btnLogin, true);
      loginErrorDiv.style.display = 'none';

      try {
        // Testar a senha com endpoint simples (ex: admin_view_keys)
        const url = `${BACKEND_URL.replace(/\/+$/, '')}/admin_view_keys?secret=${encodeURIComponent(password)}`;
        const response = await fetch(url, { method: 'GET', cache: 'no-store' });
        const data = await response.json();

        if (data.status === 'success') {
          adminSecret = password;
          loginModal.style.display = 'none';
          setPanelEnabled(true);
          showToast('Login bem-sucedido!', 'success');
          viewKeys(); // Carregar chaves ap√≥s login
        } else {
          loginErrorDiv.textContent = data.message || 'Senha incorreta.';
          loginErrorDiv.style.display = 'block';
          setPanelEnabled(false);
        }
      } catch (error) {
        loginErrorDiv.textContent = 'Erro de conex√£o ao tentar logar.';
        loginErrorDiv.style.display = 'block';
        setPanelEnabled(false);
        console.error("Erro no login:", error);
      }
      setLoading(btnLogin, false);
    }

    function handleLogout() {
      adminSecret = '';
      setPanelEnabled(false);
      loginModal.style.display = 'flex';
      adminSecretModalInput.value = '';
      loginErrorDiv.style.display = 'none';
      keysListDisplayDiv.innerHTML = 'Nenhuma chave carregada ainda.';
      showOutput('', 'Sess√£o encerrada. Aguardando a√ß√£o...');
      showToast('Voc√™ saiu.', 'info');
    }

    // --- API CALLS ---
    async function fetchDataFromAPI(endpoint, params = {}, method = 'GET', buttonToLoad = null) {
      const backendUrl = BACKEND_URL.replace(/\/+$/, '');
      if (!adminSecret) {
        showOutput('error', '‚ö†Ô∏è Fa√ßa login primeiro.');
        handleLogout(); // For√ßar logout se o segredo sumir
        return null;
      }
      params.secret = adminSecret; // Adiciona o segredo a todos os requests

      const queryParams = new URLSearchParams(params).toString();
      const url = `${backendUrl}/${endpoint}${method === 'GET' && queryParams ? '?' + queryParams : ''}`;
      
      const fetchOptions = {
        method,
        cache: 'no-store',
        headers: {}
      };

      if (method !== 'GET') {
        fetchOptions.headers['Content-Type'] = 'application/json'; // Assumindo JSON para POST/DELETE
        fetchOptions.body = JSON.stringify(params); // Enviar params no body para POST/DELETE
      }
      
      showOutput('', '‚è≥ Processando...');
      if (buttonToLoad) setLoading(buttonToLoad, true);

      try {
        const response = await fetch(url, fetchOptions);
        if (!response.ok) { // Trata erros HTTP como 401, 403, 500 etc.
            let errorMsg = `Erro HTTP ${response.status}: ${response.statusText}`;
            try {
                const errorData = await response.json();
                errorMsg = errorData.message || errorMsg;
                if (response.status === 401 || response.status === 403) { // Unauthorized or Forbidden
                    showToast('Sess√£o expirada ou inv√°lida. Fa√ßa login novamente.', 'error');
                    handleLogout();
                }
            } catch (e) { /* n√£o conseguiu parsear JSON, usa statusText */ }
            showOutput('error', `‚ùå ${errorMsg}`);
            return null;
        }
        const data = await response.json();

        showOutput(
          data.status === 'success' ? 'success' : 'error',
          (data.status === 'success' ? '‚úÖ ' : '‚ùå ') + (data.message || (data.status === 'success' ? 'Opera√ß√£o conclu√≠da.' : 'Ocorreu um erro.')),
          data.status === 'success' ? 3000 : 5000
        );
        return data;
      } catch (err) {
        showOutput('error', '‚ùå Erro de conex√£o com o servidor: ' + err.message);
        console.error("Fetch error:", err);
        return null;
      } finally {
        if (buttonToLoad) setLoading(buttonToLoad, false);
      }
    }

    // --- A√á√ïES DO PAINEL ---
    async function generateKeys() {
      const count = parseInt(keyCountInput.value, 10);
      if (isNaN(count) || count < 1 || count > 100) {
        showOutput('error', '‚ùå Quantidade inv√°lida. Deve ser entre 1 e 100.');
        return;
      }
      const result = await fetchDataFromAPI('admin_generate_keys', { count }, 'POST', btnGerar);
      if (result && result.status === 'success') {
        viewKeys(); // Atualiza a lista de chaves
        if (result.data && result.data.generated_keys) {
          showToast(`${result.data.generated_keys.length} chaves geradas!`, 'success');
        } else {
          showToast(`Chaves geradas!`, 'success');
        }
      }
    }

    async function viewKeys() {
      keysListDisplayDiv.innerHTML = '‚è≥ Carregando chaves...';
      const result = await fetchDataFromAPI('admin_view_keys', {}, 'GET', btnVer);

      if (!result || result.status !== 'success' || !result.data) {
        keysListDisplayDiv.innerHTML = '<p class="status-message error">Erro ao carregar chaves ou nenhuma chave encontrada.</p>';
        return;
      }

      const { available_keys = [], used_keys = [] } = result.data;
      let html = `<h3>üîë Dispon√≠veis (${available_keys.length}):</h3><ul class="key-list">`;
      html += available_keys.length > 0 
        ? available_keys.map(key => `<li>${key}<button class="copy-btn" type="button" aria-label="Copiar chave ${key}" onclick="copyKeyToClipboard('${key}', this)">üìã</button></li>`).join('')
        : '<li>Nenhuma chave dispon√≠vel.</li>';
      html += '</ul>';

      html += `<h3 style="margin-top:20px;">üì¶ Usadas (${used_keys.length}):</h3><ul class="key-list">`;
      html += used_keys.length > 0
        ? used_keys.map(key => `<li>${key}<button class="copy-btn" type="button" aria-label="Copiar chave ${key}" onclick="copyKeyToClipboard('${key}', this)">üìã</button></li>`).join('')
        : '<li>Nenhuma chave usada.</li>';
      html += '</ul>';

      keysListDisplayDiv.innerHTML = html;
    }

    async function deleteSpecificKey() {
      const keyToDelete = deleteKeyInput.value.trim();
      if (!keyToDelete) {
        showOutput('error', '‚ùå Digite a chave que deseja excluir.');
        return;
      }
      showConfirmModal(`Tem certeza que deseja excluir a chave "${keyToDelete}"?`, async () => {
        const result = await fetchDataFromAPI('admin_delete_key', { key: keyToDelete }, 'DELETE', btnExcluir);
        if (result && result.status === 'success') {
          viewKeys(); // Atualiza a lista
          deleteKeyInput.value = ''; // Limpa o campo
          showToast(`Chave "${keyToDelete}" exclu√≠da.`, 'success');
        }
      });
    }
    
    // Wrapper para deleteAllKeys para usar o modal de confirma√ß√£o
    function deleteAllKeysConfirm() {
        showConfirmModal(
            "‚ö†Ô∏è Tem certeza que deseja excluir TODAS as chaves? Essa a√ß√£o n√£o pode ser desfeita.",
            async () => { // Esta √© a callback onConfirm
                const result = await fetchDataFromAPI('admin_delete_all_keys', {}, 'DELETE', btnExcluirTodas);
                if (result && result.status === 'success') {
                    viewKeys(); // Atualiza a lista
                    showToast('Todas as chaves foram exclu√≠das!', 'success');
                }
            }
        );
    }

    // --- TEMA ---
    function toggleTheme() {
      document.body.classList.toggle('dark');
      const currentTheme = document.body.classList.contains('dark') ? 'dark' : 'light';
      localStorage.setItem('theme', currentTheme);
      themeToggleButton.textContent = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåì';
      themeToggleButton.setAttribute('aria-label', currentTheme === 'dark' ? 'Alternar para tema claro' : 'Alternar para tema escuro');
    }

    function applyInitialTheme() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark');
      }
      // Atualiza o √≠cone do bot√£o do tema
      themeToggleButton.textContent = document.body.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåì';
      themeToggleButton.setAttribute('aria-label', document.body.classList.contains('dark') ? 'Alternar para tema claro' : 'Alternar para tema escuro');

    }

    // --- INICIALIZA√á√ÉO ---
    document.addEventListener('DOMContentLoaded', () => {
      applyInitialTheme();
      currentYearSpan.textContent = new Date().getFullYear();
      
      themeToggleButton.onclick = toggleTheme;
      
      loginForm.addEventListener('submit', (event) => {
        event.preventDefault();
        handleLogin();
      });
      
      btnLogout.onclick = handleLogout;

      // Inicializa√ß√£o: bloquear painel at√© login
      setPanelEnabled(false);
      loginModal.style.display = 'flex'; // Mostrar modal de login ao carregar

      // Aviso HTTPS
      if (window.location.protocol !== "https:") {
        showToast('‚ö†Ô∏è Aten√ß√£o: Use HTTPS para maior seguran√ßa.', 'error');
      }
    });
  </script>
</body>
</html>
